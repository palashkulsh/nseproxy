-Tells which stocks have positive change in close price over a period
select symbol,avg(100*(close_price-prev_close)/prev_close) as avg_growth,min(100*(close_price-prev_close)/prev_close) as min, max(100*(close_price-prev_close)/prev_close) as max from stock_data where date between '2016-09-20' and '2016-10-04' and average_price>10 group by symbol having max>0 and min > 0 order by avg_growth;

-last 3 days positive
select symbol,avg(100*(close_price-prev_close)/prev_close) as avg_growth,min(100*(close_price-prev_close)/prev_close) as min, max(100*(close_price-prev_close)/prev_close) as max from stock_data where date between curdate() and date_sub(curdate(),interval 3 day ) and average_price>10 group by symbol having max>0 and min > 0 order by avg_growth;

-financial details for a given symbol
select distinct f.symbol,f.key_text,f16.value as '2016',f15.value as '2015',f14.value as '2014',f13.value as '2013',f12.value as '2012',f11.value as '2011',f10.value as '2010' from fin as f left outer join fin as f16 on f.symbol=f16.symbol and f.key_text=f16.key_text and f16.year=2016 left outer join fin as f15 on f.symbol=f15.symbol and f.key_text=f15.key_text and f15.year=2015 left outer join fin as f14 on f.symbol=f14.symbol and f.key_text=f14.key_text and f14.year=2014 left outer join fin as f13 on f.symbol=f13.symbol and f.key_text=f13.key_text and f13.year=2013  left outer join fin as f12 on f.symbol=f12.symbol and f.key_text=f12.key_text and f12.year=2012 left outer join fin as f11 on f.symbol=f11.symbol and f.key_text=f11.key_text and f11.year=2011  left outer join fin as f10 on f.symbol=f10.symbol and f.key_text=f10.key_text and f10.year=2010   where f.symbol='PNB'

-financial details for upto 2004
select distinct f.symbol,f.key_text,f16.value as '2016',f15.value as '2015',f14.value as '2014',f13.value as '2013',f12.value as '2012',f11.value as '2011',f10.value as '2010' , f09.value as '2009',f08.value as '2008',f07.value as '2007',f06.value as '2006',f05.value as '2005',f04.value as '2004' from fin as f left outer join fin as f16 on f.symbol=f16.symbol and f.key_text=f16.key_text and f16.year=2016 left outer join fin as f15 on f.symbol=f15.symbol and f.key_text=f15.key_text and f15.year=2015 left outer join fin as f14 on f.symbol=f14.symbol and f.key_text=f14.key_text and f14.year=2014 left outer join fin as f13 on f.symbol=f13.symbol and f.key_text=f13.key_text and f13.year=2013  left outer join fin as f12 on f.symbol=f12.symbol and f.key_text=f12.key_text and f12.year=2012 left outer join fin as f11 on f.symbol=f11.symbol and f.key_text=f11.key_text and f11.year=2011  left outer join fin as f10 on f.symbol=f10.symbol and f.key_text=f10.key_text and f10.year=2010 left outer join fin as f09 on f.symbol=f09.symbol and f.key_text=f09.key_text and f09.year=2009 left outer join fin as f08 on f.symbol=f08.symbol and f.key_text=f08.key_text and f08.year=2008 left outer join fin as f07 on f.symbol=f07.symbol and f.key_text=f07.key_text and f07.year=2007 left outer join fin as f06 on f.symbol=f06.symbol and f.key_text=f06.key_text and f06.year=2006 left outer join fin as f05 on f.symbol=f05.symbol and f.key_text=f05.key_text and f05.year=2005 left outer join fin as f04 on f.symbol=f04.symbol and f.key_text=f04.key_text and f04.year=2004   where f.symbol='PNB';

-interpreting ratios
select distinct f.symbol,f.key_text,f16.value as '2016',f15.value as '2015',f14.value as '2014',f13.value as '2013',f12.value as '2012',f11.value as '2011',f10.value as '2010' from fin as f left outer join fin as f16 on f.symbol=f16.symbol and f.key_text=f16.key_text and f16.year=2016 left outer join fin as f15 on f.symbol=f15.symbol and f.key_text=f15.key_text and f15.year=2015 left outer join fin as f14 on f.symbol=f14.symbol and f.key_text=f14.key_text and f14.year=2014 left outer join fin as f13 on f.symbol=f13.symbol and f.key_text=f13.key_text and f13.year=2013  left outer join fin as f12 on f.symbol=f12.symbol and f.key_text=f12.key_text and f12.year=2012 left outer join fin as f11 on f.symbol=f11.symbol and f.key_text=f11.key_text and f11.year=2011  left outer join fin as f10 on f.symbol=f10.symbol and f.key_text=f10.key_text and f10.year=2010   where f.symbol='PNB'


-also adding 52 week low
select temp.symbol,temp.avg_growth,temp.min,temp.max,temp.avgprice,yearlow.low52,yearlow.max52 from (select symbol,avg(100*(close_price-prev_close)/prev_close) as avg_growth,min(100*(close_price-prev_close)/prev_close) as min, max(100*(close_price-prev_close)/prev_close) as max ,avg(close_price) as avgprice from stock_data where date between  date_sub(curdate(),interval 5 day ) and  curdate() and average_price>10 group by symbol having max>0 and min > -2.0 and abs(max)>abs(min) order by avg_growth)temp inner join (select symbol,min(close_price) as low52 , max(close_price) as max52 from stock_data where date>date_sub(curdate(),interval 1 year) and date<=curdate() group by symbol ) yearlow on temp.symbol=yearlow.symbol where yearlow.max52-temp.avgprice>2*(temp.avgprice-yearlow.low52) order by avgprice;

()52 high low in a period
select hl.symbol,hl.52high,hl.52low,sdh.date as highdate,sdl.date as lowdate from (select symbol, min(average_price) as 52low,max(average_price) 52high from stock_data where series='eq' and date between  date_sub(curdate(),interval 1 year ) and  curdate() and symbol='agarind' group by symbol )hl inner join stock_data sdh on sdh.symbol=hl.symbol and hl.52high=sdh.average_price inner join stock_data sdl on hl.symbol=sdl.symbol and hl.52low=sdl.average_price and sdl.series='eq';

()52 low in a period (15 days)
select hl.symbol,hl.52low,sdl.date as lowdate from (select symbol, min(average_price) as 52low,max(average_price) 52high from stock_data where series='eq' and date between  date_sub(curdate(),interval 1 year ) and  curdate()  group by symbol )hl  inner join stock_data sdl on hl.symbol=sdl.symbol and hl.52low=sdl.average_price and sdl.series='eq' and sdl.date between date_sub(curdate(),interval 15 day) and curdate();

()52 low in a period with current value
select hl.symbol,hl.52low,sdl.date as lowdate,hl.maxdate,sdc.average_price as curprice from (select symbol, min(average_price) as 52low,max(average_price) 52high,max(date) maxdate from stock_data where series='eq' and date between  date_sub(curdate(),interval 1 year ) and  curdate()  group by symbol )hl  inner join stock_data sdl on hl.symbol=sdl.symbol and hl.52low=sdl.average_price and sdl.series='eq' inner join  stock_data  sdc on sdc.symbol=hl.symbol and sdc.series='eq'  and sdc.date = hl.date where sdl.date   between date_sub(curdate(),interval 15 day) and curdate();




